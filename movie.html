<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vajira Movie Detailer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #1a1a1a; color: #d1d1d1; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .main-container { background-color: #222222; border: 1px solid #333; border-radius: 8px; overflow: hidden; }
        .sidebar { background-color: #2a2a2a; border-right: 1px solid #333; min-width: 240px; }
        .imdb-badge { background-color: #f5c518; color: #000; font-weight: 900; padding: 2px 8px; border-radius: 4px; }
        .download-table { width: 100%; border-collapse: collapse; background: #1a1a1a; border-radius: 5px; overflow: hidden; }
        .download-table th, .download-table td { padding: 12px; border: 1px solid #333; text-align: left; }
        .btn-download { background-color: #ff4d4d; color: white; padding: 5px 15px; border-radius: 4px; font-weight: bold; transition: 0.3s; }
        .btn-download:hover { background-color: #cc0000; }
        .screenshot-img { height: 60px; border-radius: 4px; border: 1px solid #444; object-fit: cover; }
        input { background: #111 !important; border: 1px solid #444; color: white; }
    </style>
</head>
<body class="p-4 flex items-center justify-center min-h-screen">

    <div class="max-w-5xl w-full">
        <div class="flex items-center gap-2 mb-4 bg-[#111] p-2 rounded border border-gray-700">
            <span class="text-gray-500 px-2">üîç</span>
            <input id="movieUrl" type="text" value="https://pirate.lk/movies/nice-view-2022-sinhala-sub/" 
                   class="flex-1 bg-transparent outline-none text-sm p-1" placeholder="Enter URL...">
            <button onclick="fetchMovie()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-1 rounded text-sm font-bold">Get Details</button>
        </div>

        <div id="content" class="main-container flex flex-col md:flex-row hidden">
            
            <div class="sidebar p-6 flex flex-col items-center">
                <img id="poster" src="" class="w-full rounded shadow-lg border border-gray-500 mb-6" alt="Poster">
                <div class="w-full text-xs space-y-3 text-gray-400">
                    <p>Director: <span id="director" class="text-white block mt-1"></span></p>
                    <p>Runtime: <span id="runtime" class="text-white block mt-1"></span></p>
                    <p>Country: <span id="country" class="text-white block mt-1"></span></p>
                    <p>Date Created: <span id="date" class="text-white block mt-1"></span></p>
                </div>
            </div>

            <div class="flex-1 p-8">
                <h1 id="title" class="text-3xl font-bold text-white mb-1"></h1>
                <p class="text-gray-500 text-sm mb-4 italic">Fetching all details here</p>

                <div class="flex items-center gap-4 mb-6">
                    <span class="imdb-badge">IMDb</span>
                    <div>
                        <span id="rating" class="font-bold text-lg text-white"></span>
                        <span id="votes" class="text-xs text-gray-500 ml-2"></span>
                    </div>
                </div>

                <div id="genres" class="flex gap-2 mb-6"></div>

                <div class="mb-6">
                    <h3 class="text-sm font-bold border-b border-gray-700 pb-1 mb-3">Screenshots-Slider</h3>
                    <div id="screenshots" class="flex gap-2 overflow-x-auto pb-2"></div>
                </div>

                <div class="mb-2">
                    <h3 class="text-sm font-bold border-b border-gray-700 pb-1 mb-3">Download box</h3>
                    <table class="download-table text-sm">
                        <thead class="bg-[#222]">
                            <tr>
                                <th>#</th>
                                <th>Quality</th>
                                <th>Size & Platform</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="downloadList"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="loading" class="text-center py-20 text-gray-500">Enter a URL and click Get Details...</div>
    </div>

    <script>
        const API_KEY = "vajiraofficial";

        async function fetchMovie() {
            const url = document.getElementById('movieUrl').value;
            const content = document.getElementById('content');
            const loading = document.getElementById('loading');
            
            loading.innerText = "Loading data...";
            
            try {
                const response = await fetch(`https://vajira-mv-apikeys.netlify.app/api/pirate/movie?url=${url}&apikey=${API_KEY}`);
                const resData = await response.json();
                const movie = resData.data.data;

                // Map UI
                document.getElementById('title').innerText = movie.mainDetails.maintitle;
                document.getElementById('poster').src = movie.mainDetails.imageUrl;
                document.getElementById('director').innerText = movie.moviedata.director;
                document.getElementById('runtime').innerText = movie.mainDetails.runtime;
                document.getElementById('country').innerText = movie.mainDetails.country;
                document.getElementById('date').innerText = movie.mainDetails.dateCreated;
                document.getElementById('rating').innerText = movie.moviedata.imdbRating + "/10";
                document.getElementById('votes').innerText = movie.moviedata.imdbvotesCount;

                // Genres
                const genreDiv = document.getElementById('genres');
                genreDiv.innerHTML = movie.mainDetails.genres.map(g => 
                    `<span class="bg-gray-700 text-[10px] uppercase px-2 py-1 rounded">${g}</span>`
                ).join('');

                // Screenshots
                const screenDiv = document.getElementById('screenshots');
                screenDiv.innerHTML = movie.moviedata.imageUrls.map(img => 
                    `<img src="${img}" class="screenshot-img">`
                ).join('');

                // Downloads
                const dlBody = document.getElementById('downloadList');
                dlBody.innerHTML = movie.dllinks.directDownloadLinks.map((dl, index) => `
                    <tr>
                        <td class="text-gray-500">${index + 1}</td>
                        <td class="text-red-400 font-bold">${dl.quality}</td>
                        <td class="text-xs">${dl.size} <span class="text-gray-600 ml-2">(${dl.platform})</span></td>
                        <td><button onclick="getFinalLink('${dl.link}')" class="btn-download text-xs">Download</button></td>
                    </tr>
                `).join('');

                content.classList.remove('hidden');
                loading.classList.add('hidden');

            } catch (error) {
                loading.innerText = "Error loading movie. Check URL or API Key.";
            }
        }

        async function getFinalLink(dlUrl) {
            try {
                const response = await fetch(`https://vajira-mv-apikeys.netlify.app/api/pirate/download?url=${dlUrl}&apikey=${API_KEY}`);
                const resData = await response.json();
                if(resData.data.data.link) {
                    window.open(resData.data.data.link, '_blank');
                }
            } catch (e) {
                alert("Failed to fetch download link.");
            }
        }
    </script>
</body>
</html>
