<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vajira Movie Box - Full Details & Screenshots</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #ff1e2a; --bg: #0a0a0a; --card: #121212; --text: #ffffff; }
        body { background-color: var(--bg); color: var(--text); font-family: 'Plus Jakarta Sans', sans-serif; margin: 0; }
        
        /* SEARCH HEADER */
        .header { padding: 20px; background: #000; border-bottom: 1px solid #222; position: sticky; top: 0; z-index: 1000; }
        .search-box { max-width: 600px; margin: 0 auto; display: flex; gap: 10px; background: #1a1a1a; padding: 5px; border-radius: 12px; border: 1px solid #333; }
        input { flex: 1; background: transparent; border: none; color: white; padding: 12px; outline: none; font-size: 1rem; }
        .search-btn { background: var(--primary); color: white; border: none; padding: 0 20px; border-radius: 8px; font-weight: 700; cursor: pointer; }

        /* GRID */
        .container { max-width: 1200px; margin: 30px auto; padding: 0 15px; }
        .movie-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 20px; }
        .movie-card { background: var(--card); border-radius: 12px; overflow: hidden; transition: 0.3s; cursor: pointer; border: 1px solid #222; }
        .movie-card:hover { transform: translateY(-5px); border-color: var(--primary); }
        .img-box { position: relative; width: 100%; padding-top: 150%; background: #111; }
        .img-box img { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; }
        .card-title { padding: 12px; font-size: 0.85rem; font-weight: 600; text-align: center; }

        /* DETAIL OVERLAY */
        #detailOverlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #080808; z-index: 2000; display: none; overflow-y: auto;
        }
        .detail-nav { padding: 15px 20px; background: #000; display: flex; align-items: center; position: sticky; top: 0; z-index: 10; border-bottom: 1px solid #222; }
        .back-btn { background: #222; color: #fff; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; font-weight: bold; }
        
        .detail-body { max-width: 1000px; margin: 30px auto; padding: 0 20px; }
        .detail-main { display: grid; grid-template-columns: 280px 1fr; gap: 40px; margin-bottom: 40px; }
        .detail-poster { width: 100%; border-radius: 15px; border: 1px solid #333; }
        
        /* SCREENSHOT GALLERY */
        .section-label { color: var(--primary); font-weight: 800; text-transform: uppercase; letter-spacing: 1px; margin: 30px 0 15px 0; display: block; }
        .gallery { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 15px; scrollbar-width: thin; }
        .gallery img { height: 160px; border-radius: 10px; border: 1px solid #333; cursor: pointer; transition: 0.2s; }
        .gallery img:hover { transform: scale(1.05); border-color: var(--primary); }

        /* CAST SECTION */
        .cast-list { display: flex; gap: 15px; overflow-x: auto; padding-bottom: 10px; }
        .cast-item { min-width: 100px; text-align: center; }
        .cast-img { width: 70px; height: 70px; border-radius: 50%; object-fit: cover; border: 2px solid #333; margin-bottom: 5px; }
        .cast-name { font-size: 0.75rem; color: #fff; font-weight: 600; display: block; }

        .dl-container { background: #111; border-radius: 15px; padding: 25px; border: 1px solid #222; margin-top: 20px; }
        .dl-item { display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid #222; }
        .dl-btn { background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 8px; font-weight: 800; cursor: pointer; }

        @media (max-width: 700px) {
            .detail-main { grid-template-columns: 1fr; text-align: center; }
            .detail-poster { max-width: 220px; margin: 0 auto; }
            .movie-grid { grid-template-columns: repeat(2, 1fr); }
            .dl-item { flex-direction: column; gap: 10px; text-align: center; }
        }
    </style>
</head>
<body>

<div class="header">
    <div class="search-box">
        <input type="text" id="searchInput" placeholder="Search movies...">
        <button class="search-btn" onclick="searchMovies()">SEARCH</button>
    </div>
</div>

<div class="container">
    <h2 id="status">Discover</h2>
    <div id="loading" style="display:none; text-align:center; padding: 20px; color: var(--primary);">Loading...</div>
    <div class="movie-grid" id="grid"></div>
</div>

<div id="detailOverlay">
    <div class="detail-nav">
        <button class="back-btn" onclick="closeDetails()">‚Üê BACK TO LIST</button>
    </div>
    <div id="fullDetailContent" class="detail-body"></div>
</div>

<script>
    const apikey = "vajiraofficial";
    const proxy = "https://api.allorigins.win/get?url=";

    async function fetchData(url) {
        const response = await fetch(proxy + encodeURIComponent(url));
        const json = await response.json();
        return JSON.parse(json.contents);
    }

    async function searchMovies() {
        const query = document.getElementById('searchInput').value;
        if (!query) return;
        const grid = document.getElementById('grid');
        const loader = document.getElementById('loading');
        grid.innerHTML = '';
        loader.style.display = 'block';

        const url = `https://vajira-mv-apikeys.netlify.app/api/pirate/search?q=${encodeURIComponent(query)}&apikey=${apikey}`;
        
        try {
            const data = await fetchData(url);
            const movies = data?.data?.data?.data || data?.data?.data || [];
            loader.style.display = 'none';

            movies.forEach(m => {
                const imgUrl = m.image || m.imageSrc || 'https://via.placeholder.com/300x450';
                const card = document.createElement('div');
                card.className = 'movie-card';
                card.onclick = () => openDetails(m.link);
                card.innerHTML = `<div class="img-box"><img src="${imgUrl}"></div><div class="card-title">${m.title}</div>`;
                grid.appendChild(card);
            });
        } catch(e) { loader.style.display = 'none'; }
    }

    async function openDetails(movieUrl) {
        const overlay = document.getElementById('detailOverlay');
        const content = document.getElementById('fullDetailContent');
        overlay.style.display = 'block';
        document.body.style.overflow = 'hidden';
        content.innerHTML = '<h3 style="text-align:center; margin-top:100px;">Gathering Movie Details...</h3>';

        const apiUrl = `https://vajira-mv-apikeys.netlify.app/api/pirate/movie?url=${encodeURIComponent(movieUrl)}&apikey=${apikey}`;

        try {
            const data = await fetchData(apiUrl);
            const res = data?.data?.data || data?.data;
            const main = res.mainDetails;
            const meta = res.moviedata;
            const cast = res.cast || [];
            const links = res.dllinks?.directDownloadLinks || [];

            content.innerHTML = `
                <div class="detail-main">
                    <img src="${main.imageUrl}" class="detail-poster">
                    <div>
                        <h1 style="margin:0;">${main.maintitle}</h1>
                        <p style="color:#f5c518; font-weight:800; margin:10px 0;">IMDb: ${meta.imdbRating || 'N/A'}</p>
                        <p style="color:#aaa; line-height:1.6;">${meta.description || 'No description available.'}</p>
                        <p><strong>Director:</strong> ${meta.director || 'N/A'}</p>
                        <p><strong>Countries:</strong> ${main.country || 'N/A'}</p>
                    </div>
                </div>

                <span class="section-label">Cast & Characters</span>
                <div class="cast-list">
                    ${cast.map(c => `
                        <div class="cast-item">
                            <img src="${c.image || 'https://via.placeholder.com/100'}" class="cast-img">
                            <span class="cast-name">${c.name}</span>
                        </div>
                    `).join('')}
                </div>

                <span class="section-label">Screenshots Gallery</span>
                <div class="gallery">
                    ${meta.imageUrls.map(url => `<img src="${url}" onclick="window.open(this.src)">`).join('')}
                </div>

                <div class="dl-container">
                    <span class="section-label" style="margin-top:0;">Download Options</span>
                    ${links.map(l => `
                        <div class="dl-item">
                            <div>
                                <b style="color:var(--primary)">${l.quality}</b><br>
                                <small style="color:#888;">${l.size} | ${l.platform}</small>
                            </div>
                            <button class="dl-btn" onclick="handleDl('${l.link}', this)">GET FILE</button>
                        </div>
                    `).join('')}
                </div>
            `;
        } catch(e) { content.innerHTML = '<p>Failed to load data.</p>'; }
    }

    async function handleDl(url, btn) {
        const oldText = btn.innerText;
        btn.innerText = "BYPASSING...";
        const dlUrl = `https://vajira-mv-apikeys.netlify.app/api/pirate/download?url=${encodeURIComponent(url)}&apikey=${apikey}`;
        try {
            const data = await fetchData(dlUrl);
            const finalLink = data?.data?.data?.link || data?.data?.link;
            window.location.href = finalLink.replace('api/file/', 'u/');
        } catch(e) { alert("Download failed"); }
        btn.innerText = oldText;
    }

    function closeDetails() {
        document.getElementById('detailOverlay').style.display = 'none';
        document.body.style.overflow = 'auto';
    }
</script>
</body>
</html>
