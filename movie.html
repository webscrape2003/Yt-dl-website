<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Vajira Movie Detailer – Full Fix</title>

<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap" rel="stylesheet">

<style>
:root{
  --primary:#ff1e2a;--primary-glow:rgba(255,30,42,.4);
  --bg:#0a0a0a;--card:#121212;--text:#fff;
}
body{margin:0;background:var(--bg);color:var(--text);font-family:'Plus Jakarta Sans',sans-serif}

/* SEARCH */
.header{padding:20px;background:#000;border-bottom:1px solid #222;position:sticky;top:0;z-index:10}
.search-box{max-width:600px;margin:auto;display:flex;gap:10px;background:#1a1a1a;padding:6px;border-radius:12px;border:1px solid #333}
.search-box input{flex:1;background:transparent;border:none;color:#fff;padding:12px;outline:none}
.search-box button{background:var(--primary);border:none;border-radius:8px;color:#fff;font-weight:700;padding:0 20px}
.container{max-width:1200px;margin:30px auto;padding:0 15px}
.movie-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:20px}
.movie-card{background:var(--card);border-radius:12px;overflow:hidden;border:1px solid #222;cursor:pointer;transition:.3s}
.movie-card:hover{transform:translateY(-6px);border-color:var(--primary)}
.image-container{position:relative;width:100%;padding-top:145%;background:#1a1a1a}
.movie-card img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover}
.card-info{padding:15px;background:linear-gradient(to top,#000 85%,transparent);margin-top:-70px}
.card-title{text-align:center;font-size:.85rem}

/* DETAILS OVERLAY */
.details-panel{
  position:fixed;inset:15px;background:linear-gradient(145deg,#0f0f0f,#070707);
  border-radius:20px;border:1px solid #222;z-index:9999;display:none;
  box-shadow:0 30px 80px rgba(0,0,0,.9);overflow:hidden;
}
.details-header{
  display:flex;gap:10px;padding:15px;background:rgba(0,0,0,.6);border-bottom:1px solid #222
}
.details-header input{
  flex:1;background:#111;border:1px solid #333;color:#fff;padding:10px 14px;border-radius:8px
}
.details-header button{
  background:var(--primary);border:none;color:#fff;padding:0 20px;border-radius:8px;font-weight:700
}
.close-btn{background:#222!important}

.details-body{
  display:grid;grid-template-columns:260px 1fr;gap:25px;padding:25px;
  height:calc(100% - 70px);overflow-y:auto
}
.left-poster img{width:100%;border-radius:12px;border:1px solid #333}
.meta-left{margin-top:15px;font-size:.85rem;color:#aaa}
.meta-left div{margin-bottom:6px}

.imdb-badge{background:#f5c518;color:#000;padding:4px 10px;border-radius:5px;font-weight:800}
.tag-row span{
  display:inline-block;background:rgba(255,255,255,.06);border:1px solid #333;
  padding:4px 10px;border-radius:20px;margin:4px 6px 0 0;font-size:.75rem
}
.description{color:#aaa;line-height:1.6;margin:15px 0 25px}

.screenshot-slider{display:flex;gap:10px;overflow-x:auto;padding-bottom:10px}
.screenshot-slider img{height:110px;border-radius:8px;border:1px solid #222;cursor:pointer}

.download-box .dl-row{
  display:flex;justify-content:space-between;align-items:center;
  background:rgba(255,255,255,.03);border:1px solid #222;border-radius:10px;
  padding:12px 15px;margin-bottom:10px
}
.download-box button{
  background:#111;border:1px solid #333;color:#fff;padding:6px 14px;border-radius:6px
}

@media(max-width:800px){
  .details-body{grid-template-columns:1fr}
}
</style>
</head>
<body>

<div class="header">
  <div class="search-box">
    <input id="searchInput" placeholder="Search movie..." />
    <button onclick="searchMovies()">Search</button>
  </div>
</div>

<div class="container">
  <div class="movie-grid" id="movieGrid"></div>
</div>

<!-- DETAILS PANEL -->
<div class="details-panel" id="detailsPanel">
  <div class="details-header">
    <input id="detailUrlInput" />
    <button onclick="fetchMovieDetails()">Get Details</button>
    <button class="close-btn" onclick="closeDetails()">✕</button>
  </div>
  <div class="details-body">
    <div class="left-poster">
      <img id="detailPoster" />
      <div class="meta-left">
        <div><b>Director:</b> <span id="detailDirector"></span></div>
        <div><b>Runtime:</b> <span id="detailRuntime"></span></div>
        <div><b>Country:</b> <span id="detailCountry"></span></div>
        <div><b>Date:</b> <span id="detailDate"></span></div>
      </div>
    </div>
    <div>
      <h1 id="detailTitle"></h1>
      <div class="rating-row">
        <span class="imdb-badge">IMDb <span id="detailImdb"></span></span>
      </div>
      <div class="tag-row" id="detailGenres"></div>
      <p class="description" id="detailDescription"></p>

      <h3>Screenshots</h3>
      <div class="screenshot-slider" id="detailScreenshots"></div>

      <h3>Download Options</h3>
      <div class="download-box" id="detailDownloads"></div>
    </div>
  </div>
</div>

<script>
const apikey="vajiraofficial";
const proxy="https://api.allorigins.win/get?url=";

async function searchMovies(){
  const q=document.getElementById("searchInput").value.trim();
  if(!q) return;
  const url=`https://vajira-mv-apikeys.netlify.app/api/pirate/search?q=${encodeURIComponent(q)}&apikey=${apikey}`;
  const r=await fetch(proxy+encodeURIComponent(url));
  const w=await r.json();
  const data=JSON.parse(w.contents);
  const arr=data?.data?.data?.data||[];
  document.getElementById("movieGrid").innerHTML=arr.map(m=>`
    <div class="movie-card" onclick="openDetails('${m.link}')">
      <div class="image-container"><img src="${m.imageSrc||m.image}"></div>
      <div class="card-info"><div class="card-title">${m.title}</div></div>
    </div>
  `).join("");
}

function openDetails(url){
  document.getElementById("detailsPanel").style.display="block";
  document.getElementById("detailUrlInput").value=url;
  fetchMovieDetails();
}

function closeDetails(){
  document.getElementById("detailsPanel").style.display="none";
}

async function fetchMovieDetails(){
  const u=document.getElementById("detailUrlInput").value.trim();
  const api=`https://vajira-mv-apikeys.netlify.app/api/pirate/movie?url=${encodeURIComponent(u)}&apikey=${apikey}`;
  const r=await fetch(proxy+encodeURIComponent(api));
  const w=await r.json();
  const res=JSON.parse(w.contents);

  const movie=res.data.data.mainDetails;
  const extra=res.data.data.moviedata;
  const links=res.data.data.dllinks.directDownloadLinks;

  detailPoster.src=movie.imageUrl;
  detailTitle.innerText=movie.maintitle;
  detailDirector.innerText=extra.director||"N/A";
  detailRuntime.innerText=movie.runtime||"N/A";
  detailCountry.innerText=movie.country||"N/A";
  detailDate.innerText=movie.dateCreated||"N/A";
  detailImdb.innerText=extra.imdbRating||"N/A";
  detailGenres.innerHTML=(movie.genres||[]).map(g=>`<span>${g}</span>`).join("");
  detailDescription.innerText=extra.description||"No description";
  detailScreenshots.innerHTML=(extra.imageUrls||[]).map(u=>`<img src="${u}" onclick="window.open('${u}')">`).join("");
  detailDownloads.innerHTML=(links||[]).map(l=>`
    <div class="dl-row">
      <div><b>${l.quality}</b> <span style="color:#888">${l.size}</span></div>
      <button onclick="window.open('${l.link}','_blank')">Download</button>
    </div>
  `).join("");
}
</script>

</body>
</html>
